version: 2

sources:
  - name: taxi_data
    description: New York City yellow taxi trip data from TLC
    # Using read_parquet as external table source
    tables:
      - name: yellow_taxi_parquet
        description: Yellow taxi trip records loaded from parquet files
        meta:
          external_location: /Users/skarangi/projects/trainings/my-dbt-learning-plan/dbt_project/data/raw/yellow_taxi/yellow_tripdata_*.parquet
        columns:
          - name: tpep_pickup_datetime
            description: Pickup datetime in America/New_York timezone

          - name: tpep_dropoff_datetime
            description: Dropoff datetime in America/New_York timezone

          - name: payment_type
            description: Payment method code (0=Unknown, 1=Credit, 2=Cash, 3=No Charge, 4=Dispute, 5=Unknown, 6=Voided Trip)

          - name: fare_amount
            description: Base fare amount in USD

          - name: total_amount
            description: Total trip amount in USD (includes fare, tolls, tips, surcharges)

models:
  - name: yellow_taxi_raw
    description: Raw yellow taxi trip data view
    columns:
      - name: tpep_pickup_datetime
        description: Pickup datetime in America/New_York timezone
        tests:
          - not_null
          - columns_equal:
              arguments:
                column2: tpep_dropoff_datetime

      - name: tpep_dropoff_datetime
        description: Dropoff datetime in America/New_York timezone
        tests:
          - not_null

      - name: payment_type
        description: Payment type code
        tests:
          - accepted_values:
              arguments:
                values: [0, 1, 2, 3, 4, 5, 6]
      - name: fare_amount
        description: Fare amount in USD
        tests:
          - not_null
          - amount_positive

      - name: total_amount
        description: Total amount in USD
        tests:
          - not_null
          - amount_positive

# NOTE: columns_equal test example usage
# To validate two columns are equal, use:
#   - name: calculated_total
#     tests:
#       - columns_equal:
#           arguments:
#             column2: stored_total
# This validates that calculated_total = stored_total
